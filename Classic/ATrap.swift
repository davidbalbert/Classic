//
//  ATrap.swift
//  Classic
//
//  Created by David Albert on 7/18/20.
//  Copyright Â© 2020 David Albert. All rights reserved.
//

import Foundation

// Data from Mac Almanac II
// http://webcache.googleusercontent.com/search?q=cache:6y5NwwN0foIJ:www.mac.linux-m68k.org/devel/macalmanac.php+&cd=2&hl=en&ct=clnk&gl=us


private let traps: [UInt16: String] = [
    0xa000: "_Open",
    0xa001: "_Close",
    0xa002: "_Read",
    0xa003: "_Write",
    0xa004: "_Control",
    0xa005: "_Status",
    0xa006: "_KillIO",
    0xa007: "_GetVolInfo",
    0xa008: "_Create",
    0xa009: "_Delete",
    0xa00a: "_OpenRF",
    0xa00b: "_Rename",
    0xa00c: "_GetFileInfo",
    0xa00d: "_SetFileInfo",
    0xa00e: "_UnmountVol",
    0xa00f: "_MountVol",
    0xa010: "_Allocate",
    0xa011: "_GetEOF",
    0xa012: "_SetEOF",
    0xa013: "_FlushVol",
    0xa014: "_GetVol",
    0xa015: "_SetVol",
    0xa016: "_InitQueue",
    0xa017: "_Eject",
    0xa018: "_GetFPos",
    0xa019: "_InitZone",
    0xa01b: "_SetZone",
    0xa01c: "_FreeMem",
    0xa01f: "_DisposPtr",
    0xa020: "_SetPtrSize",
    0xa021: "_GetPtrSize",
    0xa023: "_DisposHandle",
    0xa024: "_SetHandleSize",
    0xa025: "_GetHandleSize",
    0xa027: "_ReallocHandle",
    0xa029: "_HLock",
    0xa02a: "_HUnlock",
    0xa02b: "_EmptyHandle",
    0xa02c: "_InitApplZone",
    0xa02d: "_SetApplLimit",
    0xa02e: "_BlockMove",
    0xa02f: "_PostEvent",
    0xa030: "_OSEventAvail",
    0xa031: "_GetOSEvent",
    0xa032: "_FlushEvents",
    0xa033: "_VInstall",
    0xa034: "_VRemove",
    0xa035: "_Offline",
    0xa036: "_MoreMasters",
    0xa038: "_WriteParam",
    0xa039: "_ReadDateTime",
    0xa03a: "_SetDateTime",
    0xa03b: "_Delay",
    0xa03c: "_CmpString",
    0xa03d: "_DrvrInstall",
    0xa03e: "_DrvrRemove",
    0xa03f: "_InitUtil",
    0xa040: "_ResrvMem",
    0xa041: "_SetFilLock",
    0xa042: "_RstFilLock",
    0xa043: "_SetFilType",
    0xa044: "_SetFPos",
    0xa045: "_FlushFile",
    0xa047: "_SetTrapAddress",
    0xa049: "_HPurge",
    0xa04a: "_HNoPurge",
    0xa04b: "_SetGrowZone",
    0xa04c: "_CompactMem",
    0xa04d: "_PurgeMem",
    0xa04e: "_AddDrive",
    0xa04f: "_RDrvrInstall",
    0xa050: "_RelString",
    0xa054: "_UprString",
    0xa055: "_StripAddress",
    0xa057: "_SetAppBase",
    0xa05d: "_SwapMMUMode",
    0xa061: "_MaxBlock",
    0xa062: "_PurgeSpace",
    0xa063: "_MaxApplZone",
    0xa064: "_MoveHHi",
    0xa065: "_StackSpace",
    0xa066: "_NewEmptyHandle",
    0xa067: "_HSetRBit",
    0xa068: "_HClrRBit",
    0xa069: "_HGetState",
    0xa06a: "_HSetState",
    0xa06e: "_SlotManager",
    0xa06f: "_SlotVInstall",
    0xa070: "_SlotVRemove",
    0xa071: "_AttachVBL",
    0xa072: "_DoVBLTask",
    0xa075: "_SIntInstall",
    0xa076: "_SIntRemove",
    0xa077: "_CountADBs",
    0xa078: "_GetIndADB",
    0xa079: "_GetADBInfo",
    0xa07a: "_SetADBInfo",
    0xa07b: "_ADBReInit",
    0xa07c: "_ADBOp",
    0xa07d: "_GetDefaultStartup",
    0xa07e: "_SetDefaultStartup",
    0xa07f: "_InternalWait",
    0xa080: "_GetVideoDefault",
    0xa081: "_SetVideoDefault",
    0xa082: "_DTInstall",
    0xa083: "_SetOSDefault",
    0xa084: "_GetOSDefault",
    0xa090: "_SysEnvirons",
    0xa11a: "_GetZone",
    0xa11d: "_MaxMem",
    0xa11e: "_NewPtr",
    0xa122: "_NewHandle",
    0xa126: "_HandleZone",
    0xa128: "_RecoverHandle",
    0xa12f: "_PPostEvent",
    0xa146: "_GetTrapAddress",
    0xa148: "_PtrZone",
    0xa260: "_HFSDispatch",
    0xa808: "_InitProcMenu",
    0xa809: "_GetCVariant",
    0xa80a: "_GetWVariant",
    0xa80b: "_PopUpMenuSelect",
    0xa80c: "_RGetResource",
    0xa80d: "_Count1Resources",
    0xa80e: "_Get1IxResource",
    0xa80f: "_Get1IxType",
    0xa810: "_Unique1ID",
    0xa811: "_TESelView",
    0xa812: "_TEPinScroll",
    0xa813: "_TEAutoView",
    0xa815: "_SCSIDispatch",
    0xa816: "_Pack8",
    0xa817: "_CopyMask",
    0xa818: "_FixAtan2",
    0xa81c: "_Count1Types",
    0xa81f: "_Get1Resource",
    0xa820: "_Get1NamedResource",
    0xa821: "_MaxSizeRsrc",
    0xa826: "_InsMenuItem",
    0xa827: "_HideDItem",
    0xa828: "_ShowDItem",
    0xa82b: "_Pack9",
    0xa82c: "_Pack10",
    0xa82d: "_Pack11",
    0xa82e: "_Pack12",
    0xa82f: "_Pack13",
    0xa830: "_Pack14",
    0xa831: "_Pack15",
    0xa834: "_SetFScaleDisable",
    0xa835: "_FontMetrics",
    0xa837: "_MeasureText",
    0xa838: "_CalcMask",
    0xa839: "_SeedFill",
    0xa83a: "_ZoomWindow",
    0xa83b: "_TrackBox",
    0xa83c: "_TEGetOffset",
    0xa83d: "_TEDispatch",
    0xa83e: "_TEStyleNew",
    0xa83f: "_Long2Fix",
    0xa840: "_Fix2Long",
    0xa841: "_Fix2Frac",
    0xa842: "_Frac2Fix",
    0xa843: "_Fix2X",
    0xa844: "_X2Fix",
    0xa845: "_Frac2X",
    0xa846: "_X2Frac",
    0xa847: "_FracCos",
    0xa848: "_FracSin",
    0xa849: "_FracSqrt",
    0xa84a: "_FracMul",
    0xa84b: "_FracDiv",
    0xa84d: "_FixDiv",
    0xa84e: "_GetItemCmd",
    0xa84f: "_SetItemCmd",
    0xa850: "_InitCursor",
    0xa851: "_SetCursor",
    0xa852: "_HideCursor",
    0xa853: "_ShowCursor",
    0xa855: "_ShieldCursor",
    0xa856: "_ObscureCursor",
    0xa858: "_BitAnd",
    0xa859: "_BitXor",
    0xa85a: "_BitNot",
    0xa85b: "_BitOr",
    0xa85c: "_BitShift",
    0xa85d: "_BitTst",
    0xa85e: "_BitSet",
    0xa85f: "_BitClr",
    0xa861: "_Random",
    0xa862: "_ForeColor",
    0xa863: "_BackColor",
    0xa864: "_ColorBit",
    0xa865: "_GetPixel",
    0xa866: "_StuffHex",
    0xa867: "_LongMul",
    0xa868: "_FixMul",
    0xa869: "_FixRatio",
    0xa86a: "_HiWord",
    0xa86b: "_LoWord",
    0xa86c: "_FixRound",
    0xa86d: "_InitPort",
    0xa86e: "_InitGraf",
    0xa86f: "_OpenPort",
    0xa870: "_LocalToGlobal",
    0xa871: "_GlobalToLocal",
    0xa872: "_GrafDevice",
    0xa873: "_SetPort",
    0xa874: "_GetPort",
    0xa875: "_SetPBits",
    0xa876: "_PortSize",
    0xa877: "_MovePortTo",
    0xa878: "_SetOrigin",
    0xa879: "_SetClip",
    0xa87a: "_GetClip",
    0xa87b: "_ClipRect",
    0xa87c: "_BackPat",
    0xa87d: "_ClosePort",
    0xa87e: "_AddPt",
    0xa87f: "_SubPt",
    0xa880: "_SetPt",
    0xa881: "_EqualPt",
    0xa882: "_StdText",
    0xa883: "_DrawChar",
    0xa884: "_DrawString",
    0xa885: "_DrawText",
    0xa886: "_TextWidth",
    0xa887: "_TextFont",
    0xa888: "_TextFace",
    0xa889: "_TextMode",
    0xa88a: "_TextSize",
    0xa88b: "_GetFontInfo",
    0xa88c: "_StringWidth",
    0xa88d: "_CharWidth",
    0xa88e: "_SpaceExtra",
    0xa890: "_StdLine",
    0xa891: "_LineTo",
    0xa892: "_Line",
    0xa893: "_MoveTo",
    0xa894: "_Move",
    0xa895: "_Shutdown",
    0xa896: "_HidePen",
    0xa897: "_ShowPen",
    0xa898: "_GetPenState",
    0xa899: "_SetPenState",
    0xa89a: "_GetPen",
    0xa89b: "_PenSize",
    0xa89c: "_PenMode",
    0xa89d: "_PenPat",
    0xa89e: "_PenNormal",
    0xa8a0: "_StdRect",
    0xa8a1: "_FrameRect",
    0xa8a2: "_PaintRect",
    0xa8a3: "_EraseRect",
    0xa8a4: "_InverRect",
    0xa8a5: "_FillRect",
    0xa8a6: "_EqualRect",
    0xa8a7: "_SetRect",
    0xa8a8: "_OffsetRect",
    0xa8a9: "_InsetRect",
    0xa8aa: "_SectRect",
    0xa8ab: "_UnionRect",
    0xa8ac: "_Pt2Rect",
    0xa8ad: "_PtInRect",
    0xa8ae: "_EmptyRect",
    0xa8af: "_StdRRect",
    0xa8b0: "_FrameRoundRect",
    0xa8b1: "_PaintRoundRect",
    0xa8b2: "_EraseRoundRect",
    0xa8b3: "_InverRoundRect",
    0xa8b4: "_FillRoundRect",
    0xa8b5: "_ScriptUtil",
    0xa8b6: "_StdOval",
    0xa8b7: "_FrameOval",
    0xa8b8: "_PaintOval",
    0xa8b9: "_EraseOval",
    0xa8ba: "_InvertOval",
    0xa8bb: "_FillOval",
    0xa8bc: "_SlopeFromAngle",
    0xa8bd: "_StdArc",
    0xa8be: "_FrameArc",
    0xa8bf: "_PaintArc",
    0xa8c0: "_EraseArc",
    0xa8c1: "_InvertArc",
    0xa8c2: "_FillArc",
    0xa8c3: "_PtToAngle",
    0xa8c4: "_AngleFromSlope",
    0xa8c5: "_StdPoly",
    0xa8c6: "_FramePoly",
    0xa8c7: "_PaintPoly",
    0xa8c8: "_ErasePoly",
    0xa8c9: "_InvertPoly",
    0xa8ca: "_FillPoly",
    0xa8cb: "_OpenPoly",
    0xa8cc: "_ClosePgon",
    0xa8cd: "_KillPoly",
    0xa8ce: "_OffsetPoly",
    0xa8cf: "_PackBits",
    0xa8d0: "_UnpackBits",
    0xa8d1: "_StdRgn",
    0xa8d2: "_FrameRgn",
    0xa8d3: "_PaintRgn",
    0xa8d4: "_EraseRgn",
    0xa8d5: "_InverRgn",
    0xa8d6: "_FillRgn",
    0xa8d8: "_NewRgn",
    0xa8d9: "_DisposRgn",
    0xa8da: "_OpenRgn",
    0xa8db: "_CloseRgn",
    0xa8dc: "_CopyRgn",
    0xa8dd: "_SetEmptyRgn",
    0xa8de: "_SetRecRgn",
    0xa8df: "_RectRgn",
    0xa8e0: "_OfsetRgn",
    0xa8e1: "_InsetRgn",
    0xa8e2: "_EmptyRgn",
    0xa8e3: "_EqualRgn",
    0xa8e4: "_SectRgn",
    0xa8e5: "_UnionRgn",
    0xa8e6: "_DiffRgn",
    0xa8e7: "_XorRgn",
    0xa8e8: "_PtInRgn",
    0xa8e9: "_RectInRgn",
    0xa8ea: "_SetStdProcs",
    0xa8eb: "_StdBits",
    0xa8ec: "_CopyBits",
    0xa8ed: "_StdTxMeas",
    0xa8ee: "_StdGetPic",
    0xa8ef: "_ScrollRect",
    0xa8f0: "_StdPutPic",
    0xa8f1: "_StdComment",
    0xa8f2: "_PicComment",
    0xa8f3: "_OpenPicture",
    0xa8f4: "_ClosePicture",
    0xa8f5: "_KillPicture",
    0xa8f6: "_DrawPicture",
    0xa8f8: "_ScalePt",
    0xa8f9: "_MapPt",
    0xa8fa: "_MapRect",
    0xa8fb: "_MapRgn",
    0xa8fc: "_MapPoly",
    0xa8fe: "_InitFonts",
    0xa8ff: "_GetFName",
    0xa900: "_GetFNum",
    0xa901: "_FMSwapFont",
    0xa902: "_RealFont",
    0xa903: "_SetFontLock",
    0xa904: "_DrawGrowIcon",
    0xa905: "_DragGrayRgn",
    0xa906: "_NewString",
    0xa907: "_SetString",
    0xa908: "_ShowHide",
    0xa909: "_CalcVis",
    0xa90a: "_CalcVBehind",
    0xa90b: "_ClipAbove",
    0xa90c: "_PaintOne",
    0xa90d: "_PaintBehind",
    0xa90e: "_SaveOld",
    0xa90f: "_DrawNew",
    0xa910: "_GetWMgrPort",
    0xa911: "_CheckUpdate",
    0xa912: "_InitWindows",
    0xa913: "_NewWindow",
    0xa914: "_DisposWindow",
    0xa915: "_ShowWindow",
    0xa916: "_HideWindow",
    0xa917: "_GetWRefCon",
    0xa918: "_SetWRefCon",
    0xa919: "_GetWTitle",
    0xa91a: "_SetWTitle",
    0xa91b: "_MoveWindow",
    0xa91c: "_HiliteWindow",
    0xa91d: "_SizeWindow",
    0xa91e: "_TrackGoAway",
    0xa91f: "_SelectWindow",
    0xa920: "_BringToFront",
    0xa921: "_SendBehind",
    0xa922: "_BeginUpdate",
    0xa923: "_EndUpdate",
    0xa924: "_FrontWindow",
    0xa925: "_DragWindow",
    0xa926: "_DragTheRgn",
    0xa927: "_InvalRgn",
    0xa928: "_InvalRect",
    0xa929: "_ValidRgn",
    0xa92a: "_ValidRect",
    0xa92b: "_GrowWindow",
    0xa92c: "_FindWindow",
    0xa92d: "_CloseWindow",
    0xa92e: "_SetWindowPic",
    0xa92f: "_GetWindowPic",
    0xa930: "_InitMenus",
    0xa931: "_NewMenu",
    0xa932: "_DisposMenu",
    0xa933: "_AppendMenu",
    0xa934: "_ClearMenuBar",
    0xa935: "_InsertMenu",
    0xa936: "_DeleteMenu",
    0xa937: "_DrawMenuBar",
    0xa938: "_HiliteMenu",
    0xa939: "_EnableItem",
    0xa93a: "_DisableItem",
    0xa93b: "_GetMenuBar",
    0xa93c: "_SetMenuBar",
    0xa93d: "_MenuSelect",
    0xa93e: "_MenuKey",
    0xa93f: "_GetItmIcon",
    0xa940: "_SetItmIcon",
    0xa941: "_GetItmStyle",
    0xa942: "_SetItmStyle",
    0xa943: "_GetItmMark",
    0xa944: "_SetItmMark",
    0xa945: "_CheckItem",
    0xa946: "_GetItem",
    0xa947: "_SetItem",
    0xa948: "_CalcMenuSize",
    0xa949: "_GetMHandle",
    0xa94a: "_SetMFlash",
    0xa94b: "_PlotIcon",
    0xa94c: "_FlashMenuBar",
    0xa94d: "_AddResMenu",
    0xa94e: "_PinRect",
    0xa94f: "_DeltaPoint",
    0xa950: "_CountMItems",
    0xa951: "_InsertResMenu",
    0xa952: "_DelMenuItem",
    0xa953: "_UpdtControl",
    0xa954: "_NewControl",
    0xa955: "_DisposControl",
    0xa956: "_KillControls",
    0xa957: "_ShowControl",
    0xa958: "_HideControl",
    0xa959: "_MoveControl",
    0xa95a: "_GetCRefCon",
    0xa95b: "_SetCRefCon",
    0xa95c: "_SizeControl",
    0xa95d: "_HiliteControl",
    0xa95e: "_GetCTitle",
    0xa95f: "_SetCTitle",
    0xa960: "_GetCtlValue",
    0xa961: "_GetMinCtl",
    0xa962: "_GetMaxCtl",
    0xa963: "_SetCtlValue",
    0xa964: "_SetMinCtl",
    0xa965: "_SetMaxCtl",
    0xa966: "_TestControl",
    0xa967: "_DragControl",
    0xa968: "_TrackControl",
    0xa969: "_DrawControls",
    0xa96a: "_GetCtlAction",
    0xa96b: "_SetCtlAction",
    0xa96c: "_FindControl",
    0xa96d: "_Draw1Control",
    0xa96e: "_Dequeue",
    0xa96f: "_Enqueue",
    0xa970: "_GetNextEvent",
    0xa971: "_EventAvail",
    0xa972: "_GetMouse",
    0xa973: "_StillDown",
    0xa974: "_Button",
    0xa975: "_TickCount",
    0xa976: "_GetKeys",
    0xa977: "_WaitMouseUp",
    0xa978: "_UpdtDialog",
    0xa979: "_CouldDialog",
    0xa97a: "_FreeDialog",
    0xa97b: "_InitDialogs",
    0xa97c: "_GetNewDialog",
    0xa97d: "_NewDialog",
    0xa97e: "_SelIText",
    0xa97f: "_IsDialogEvent",
    0xa980: "_DialogSelect",
    0xa981: "_DrawDialog",
    0xa982: "_CloseDialog",
    0xa983: "_DisposDialog",
    0xa984: "_FindDItem",
    0xa985: "_Alert",
    0xa986: "_StopAlert",
    0xa987: "_NoteAlert",
    0xa988: "_CautionAlert",
    0xa989: "_CouldAlert",
    0xa98a: "_FreeAlert",
    0xa98b: "_ParamText",
    0xa98c: "_ErrorSound",
    0xa98d: "_GetDItem",
    0xa98e: "_SetDItem",
    0xa98f: "_SetIText",
    0xa990: "_GetIText",
    0xa991: "_ModalDialog",
    0xa992: "_DetachResource",
    0xa993: "_SetResPurge",
    0xa994: "_CurResFile",
    0xa995: "_InitResources",
    0xa996: "_RsrcZoneInit",
    0xa997: "_OpenResFile",
    0xa998: "_UseResFile",
    0xa999: "_UpdateResFile",
    0xa99a: "_CloseResFile",
    0xa99b: "_SetResLoad",
    0xa99c: "_CountResources",
    0xa99d: "_GetIndResource",
    0xa99e: "_CountTypes",
    0xa99f: "_GetIndType",
    0xa9a0: "_GetResource",
    0xa9a1: "_GetNamedResource",
    0xa9a2: "_LoadResource",
    0xa9a3: "_ReleaseResource",
    0xa9a4: "_HomeResFile",
    0xa9a5: "_SizeRsrc",
    0xa9a6: "_GetResAttrs",
    0xa9a7: "_SetResAttrs",
    0xa9a8: "_GetResInfo",
    0xa9a9: "_SetResInfo",
    0xa9aa: "_ChangedResource",
    0xa9ab: "_AddResource",
    0xa9ac: "_AddReference",
    0xa9ad: "_RmveResource",
    0xa9ae: "_RmveReference",
    0xa9af: "_ResError",
    0xa9b0: "_WriteResource",
    0xa9b1: "_CreateResFile",
    0xa9b2: "_SystemEvent",
    0xa9b3: "_SystemClick",
    0xa9b4: "_SystemTask",
    0xa9b5: "_SystemMenu",
    0xa9b6: "_OpenDeskAcc",
    0xa9b7: "_CloseDeskAcc",
    0xa9b8: "_GetPattern",
    0xa9b9: "_GetCursor",
    0xa9ba: "_GetString",
    0xa9bc: "_GetPicture",
    0xa9bd: "_GetNewWindow",
    0xa9be: "_GetNewControl",
    0xa9bf: "_GetRMenu",
    0xa9c0: "_GetNewMBar",
    0xa9c1: "_UniqueID",
    0xa9c2: "_SysEdit",
    0xa9c3: "_KeyTrans",
    0xa9c4: "_OpenRFPerm",
    0xa9c5: "_RsrcMapEntry",
    0xa9c6: "_Secs2Date",
    0xa9c7: "_Date2Sec",
    0xa9c8: "_SysBeep",
    0xa9c9: "_SysError",
    0xa9cb: "_TEGetText",
    0xa9cc: "_TEInit",
    0xa9cd: "_TEDispose",
    0xa9ce: "_TextBox",
    0xa9cf: "_TESetText",
    0xa9d0: "_TECalText",
    0xa9d1: "_TESetSelect",
    0xa9d2: "_TENew",
    0xa9d3: "_TEUpdate",
    0xa9d4: "_TEClick",
    0xa9d5: "_TECopy",
    0xa9d6: "_TECut",
    0xa9d7: "_TEDelete",
    0xa9d8: "_TEActivate",
    0xa9d9: "_TEDeactivate",
    0xa9da: "_TEIdle",
    0xa9db: "_TEPaste",
    0xa9dc: "_TEKey",
    0xa9dd: "_TEScroll",
    0xa9de: "_TEInsert",
    0xa9df: "_TESetJust",
    0xa9e0: "_Munger",
    0xa9e1: "_HandToHand",
    0xa9e2: "_PtrToXHand",
    0xa9e3: "_PtrToHand",
    0xa9e4: "_HandAndHand",
    0xa9e5: "_InitPack",
    0xa9e6: "_InitAllPacks",
    0xa9e7: "_Pack0",
    0xa9e8: "_Pack1",
    0xa9e9: "_Pack2",
    0xa9ea: "_Pack3",
    0xa9eb: "_Pack4",
    0xa9ec: "_Pack5",
    0xa9ed: "_Pack6",
    0xa9ee: "_Pack7",
    0xa9ef: "_PtrAndHand",
    0xa9f0: "_LoadSeg",
    0xa9f1: "_UnloadSeg",
    0xa9f2: "_Launch",
    0xa9f3: "_Chain",
    0xa9f4: "_ExitToShell",
    0xa9f5: "_GetAppParms",
    0xa9f6: "_GetResFileAttrs",
    0xa9f7: "_SetResFileAttrs",
    0xa9f9: "_InfoScrap",
    0xa9fa: "_UnlodeScrap",
    0xa9fb: "_LodeScrap",
    0xa9fc: "_ZeroScrap",
    0xa9fd: "_GetScrap",
    0xa9fe: "_PutScrap",
    0xaa00: "_OpenCport",
    0xaa01: "_InitCport",
    0xaa03: "_NewPixMap",
    0xaa04: "_DisposPixMap",
    0xaa05: "_CopyPixMap",
    0xaa06: "_SetCPortPix",
    0xaa07: "_NewPixPat",
    0xaa08: "_DisposPixPat",
    0xaa09: "_CopyPixPat",
    0xaa0a: "_PenPixPat",
    0xaa0b: "_BackPixPat",
    0xaa0c: "_GetPixPat",
    0xaa0d: "_MakeRGBPat",
    0xaa0e: "_FillCRect",
    0xaa0f: "_FillCOval",
    0xaa10: "_FillCRoundRect",
    0xaa11: "_FillCArc",
    0xaa12: "_FillCRgn",
    0xaa13: "_FillCPoly",
    0xaa14: "_RGBForeColor",
    0xaa15: "_RGBBackColor",
    0xaa16: "_SetCPixel",
    0xaa17: "_GetCPixel",
    0xaa18: "_GetCTable",
    0xaa19: "_GetForeColor",
    0xaa1a: "_GetBackColor",
    0xaa1b: "_GetCCursor",
    0xaa1c: "_SetCCursor",
    0xaa1d: "_AllocCursor",
    0xaa1e: "_GetCIcon",
    0xaa1f: "_PlotCIcon",
    0xaa21: "_OpColor",
    0xaa22: "_HiliteColor",
    0xaa23: "_CharExtra",
    0xaa24: "_DisposCTable",
    0xaa25: "_DisposCIcon",
    0xaa26: "_DisposCCursor",
    0xaa27: "_GetMaxDevice",
    0xaa29: "_GetDeviceList",
    0xaa2a: "_GetMainDevice",
    0xaa2b: "_GetNextDevice",
    0xaa2c: "_TestDeviceAttribute",
    0xaa2d: "_SetDeviceAttribute",
    0xaa2e: "_InitGDevice",
    0xaa2f: "_NewGDevice",
    0xaa30: "_DisposGDevice",
    0xaa31: "_SetGDevice",
    0xaa32: "_GetGDevice",
    0xaa33: "_Color2Index",
    0xaa34: "_Index2Color",
    0xaa35: "_InvertColor",
    0xaa36: "_RealColor",
    0xaa37: "_GetSubTable",
    0xaa39: "_MakeITable",
    0xaa3a: "_AddSearch",
    0xaa3b: "_AddComp",
    0xaa3c: "_SetClientID",
    0xaa3d: "_ProtectEntry",
    0xaa3e: "_ReserveEntry",
    0xaa3f: "_SetEntries",
    0xaa40: "_QDError",
    0xaa41: "_SetWinColor",
    0xaa42: "_GetAuxWin",
    0xaa43: "_SetCtlColor",
    0xaa44: "_GetAuxCtl",
    0xaa45: "_NewCWindow",
    0xaa46: "_GetNewCWindow",
    0xaa47: "_SetDeskCPat",
    0xaa48: "_GetCWMgrPort",
    0xaa49: "_SaveEntries",
    0xaa4a: "_RestoreEntries",
    0xaa4b: "_NewCDialog",
    0xaa4c: "_DelSearch",
    0xaa4d: "_DelComp",
    0xaa4f: "_CalcCMask",
    0xaa50: "_SeedCFill",
    0xaa60: "_DelMCEntries",
    0xaa61: "_GetMCInfo",
    0xaa62: "_SetMCInfo",
    0xaa63: "_DispMCEntries",
    0xaa64: "_GetMCEntry",
    0xaa65: "_SetMCEntries",
    0xaa66: "_MenuChoice",
]

private func readWord(_ data: Data) -> UInt16 {
    var w = UInt16(data[data.startIndex]) << 8
    w += UInt16(data[data.startIndex+1])
    
    return w
}

private let toolboxMask: UInt16 = 0xfbff
private let osMask:      UInt16 = 0xf0ff

struct ATrap: CustomStringConvertible {
    var data: Data
    var name: String
    var value: UInt16
    
    init?(data: Data) {
        guard data.count == 2 else { return nil }
        
        let w = readWord(data)
        
        guard (w & 0xf000) == 0xa000 else { return nil }
        
        let toolbox = (w & 0x800) == 0x800
        let name: String?
        if toolbox {
            name = traps[w & toolboxMask]
        } else {
            name = traps[w & osMask]
        }
                
        self.name = name ?? "_Unknown"
        self.value = w
        self.data = data
    }
    
    var description: String {
        let hex = String(value, radix: 16).padding(toLength: 21, withPad: " ", startingAt: 0)
        
        return "\(hex)\(name)"
    }
}
